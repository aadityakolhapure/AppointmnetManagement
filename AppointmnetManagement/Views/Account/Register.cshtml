@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register | Clinic Appointment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gradient-to-br from-red-50 to-white min-h-screen flex items-center justify-center">

    <div class="bg-white shadow-2xl rounded-2xl w-full max-w-lg p-8 border border-gray-100">
        <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center bg-red-100 p-3 rounded-full">
                <i data-lucide="user-plus" class="text-red-600 w-8 h-8"></i>
            </div>
            <h2 class="text-3xl font-bold text-red-600 mt-3">Create an Account</h2>
            <p class="text-gray-500 mt-1">Join our clinic system today</p>
        </div>

        <!-- Server-side Error Alert -->
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="flex items-center bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded bottom-0 right-0 mt-4 fixed h-5 z-25 p-4" role="alert">
                <i data-lucide="alert-circle" class="w-6 h-6 mr-2"></i>
                <p>@TempData["ErrorMessage"]</p>
            </div>
        }

        <form asp-action="Register" method="post" id="registerForm" class="space-y-5">
            @Html.AntiForgeryToken()

            <!-- Full Name -->
            <div>
                <label class="block text-gray-700 font-medium mb-1">Full Name</label>
                <div class="relative">
                    <i data-lucide="user" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                    <input type="text" name="Name" id="FullName" placeholder="Enter your full name"
                           class="w-full border border-gray-300 pl-10 pr-4 py-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:outline-none" />
                </div>
                <p class="text-red-500 text-sm mt-1 hidden" id="FullNameError">Full name is required.</p>
            </div>

            <!-- Email -->
            <div>
                <label class="block text-gray-700 font-medium mb-1">Email</label>
                <div class="relative">
                    <i data-lucide="mail" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                    <input type="email" name="Email" id="Email" placeholder="Enter your email"
                           class="w-full border border-gray-300 pl-10 pr-4 py-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:outline-none" />
                </div>
                <p class="text-red-500 text-sm mt-1 hidden" id="EmailError">Enter a valid email address.</p>
            </div>

            <!-- Password -->
            <div>
                <label class="block text-gray-700 font-medium mb-1">Password</label>
                <div class="relative">
                    <i data-lucide="lock" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                    <input type="password" name="Password" id="Password" placeholder="Create a strong password"
                           class="w-full border border-gray-300 pl-10 pr-4 py-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:outline-none" />
                </div>
                <p class="text-red-500 text-sm mt-1 hidden" id="PasswordError">
                    Password must be at least 6 characters long.
                </p>
            </div>

            <!-- Role -->
            <div>
                <label class="block text-gray-700 font-medium mb-1">Role</label>
                <div class="relative">
                    <i data-lucide="users" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                    <select name="Role" id="Role"
                            class="w-full border border-gray-300 pl-10 pr-4 py-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:outline-none">
                        <option value="">Select Role</option>
                        <option value="Patient">Patient</option>
                        <option value="Doctor">Doctor</option>
                    </select>
                </div>
                <p class="text-red-500 text-sm mt-1 hidden" id="RoleError">Please select your role.</p>
            </div>

            <!-- Doctor Fields -->
            <div id="doctor-fields" class="hidden">
                <label class="block text-gray-700 font-medium mb-1">Specialization</label>
                <div class="relative">
                    <i data-lucide="stethoscope" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                    <input type="text" name="Specialization" id="Specialization"
                           placeholder="e.g. Cardiologist"
                           class="w-full border border-gray-300 pl-10 pr-4 py-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:outline-none" />
                </div>
                <p class="text-red-500 text-sm mt-1 hidden" id="SpecializationError">Specialization is required.</p>
            </div>

            <!-- Patient Fields -->
            <div id="patient-fields" class="hidden">
                <label class="block text-gray-700 font-medium mb-1">Address</label>
                <div class="relative">
                    <i data-lucide="map-pin" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                    <input type="text" name="Address" id="Address" placeholder="Enter your address"
                           class="w-full border border-gray-300 pl-10 pr-4 py-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:outline-none" />
                </div>
                <p class="text-red-500 text-sm mt-1 hidden" id="AddressError">Address is required.</p>
            </div>

            <!-- Submit -->
            <div>
                <button type="submit"
                        class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition flex items-center justify-center space-x-2">
                    <i data-lucide="check-circle" class="w-5 h-5"></i>
                    <span>Register</span>
                </button>
            </div>

            <!-- Login Redirect -->
            <div class="text-center text-sm text-gray-600 mt-4">
                Already have an account?
                <a href="@Url.Action("Login", "Account")" class="text-red-600 font-semibold hover:underline">
                    Login
                </a>
            </div>
        </form>
    </div>

    <script>
    lucide.createIcons();

    const form = document.getElementById("registerForm");
    const roleSelect = document.getElementById("Role");
    const doctorFields = document.getElementById("doctor-fields");
    const patientFields = document.getElementById("patient-fields");

    roleSelect.addEventListener("change", () => {
        doctorFields.classList.add("hidden");
        patientFields.classList.add("hidden");
        if (roleSelect.value === "Doctor") doctorFields.classList.remove("hidden");
        else if (roleSelect.value === "Patient") patientFields.classList.remove("hidden");
    });

    form.addEventListener("submit", (e) => {
        let isValid = true;

        const fullName = document.getElementById("FullName");
        const email = document.getElementById("Email");
        const password = document.getElementById("Password");
        const role = document.getElementById("Role");
        const specialization = document.getElementById("Specialization");
        const address = document.getElementById("Address");

        document.querySelectorAll("p.text-red-500").forEach(p => p.classList.add("hidden"));

        // Full Name
        if (fullName.value.trim() === "") { showError("FullNameError"); isValid = false; }


        // Password
        if (password.value.length < 6) { showError("PasswordError"); isValid = false; }

        // Role
        if (role.value === "") { showError("RoleError"); isValid = false; }

        // Conditional Validation
        if (role.value === "Doctor" && specialization.value.trim() === "") { showError("SpecializationError"); isValid = false; }
        if (role.value === "Patient" && address.value.trim() === "") { showError("AddressError"); isValid = false; }

        if (!isValid) e.preventDefault();
    });

    function showError(id) { document.getElementById(id).classList.remove("hidden"); }
    </script>


</body>
</html>
